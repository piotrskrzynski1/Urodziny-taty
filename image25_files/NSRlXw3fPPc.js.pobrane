;/*FB_PKG_DELIM*/

__d("CometMessengerShareGating",["qex"],(function(a,b,c,d,e,f,g){"use strict";function a(){return c("qex")._("495")===!0}g.shouldEnableBCFSingleFetchXMA=a}),98);
__d("MAWFetchXMABlob",["FBLogger","Promise"],(function(a,b,c,d,e,f,g){"use strict";var h;function a(a){var d=a.descriptionForLogging,e=a.url,f=a.xmaContentType;return e==null||e===""?(h||(h=b("Promise"))).resolve():window.fetch(e).then(function(a){return a.blob()})["catch"](function(a){c("FBLogger")("messenger_web_sharing").mustfix("Error fetching url in xma share from %s, with XMA content type %s and error %s",d,f,a);return(h||(h=b("Promise"))).resolve()})}g.fetchBlob=a}),98);
__d("MAWFetchXMAData_LinkPreviewQuery_facebookRelayOperation",[],(function(a,b,c,d,e,f){e.exports="8406450339459389"}),null);
__d("MAWFetchXMAData_LinkPreviewQuery.graphql",["MAWFetchXMAData_LinkPreviewQuery_facebookRelayOperation"],(function(a,b,c,d,e,f){"use strict";a=function(){var a={defaultValue:null,kind:"LocalArgument",name:"maxPreviewHeight"},c={defaultValue:null,kind:"LocalArgument",name:"maxPreviewWidth"},d={defaultValue:null,kind:"LocalArgument",name:"url"},e=[{alias:null,args:[{fields:[{kind:"Variable",name:"maxPreviewHeight",variableName:"maxPreviewHeight"},{kind:"Variable",name:"maxPreviewWidth",variableName:"maxPreviewWidth"},{kind:"Variable",name:"url",variableName:"url"}],kind:"ObjectValue",name:"params"}],kind:"ScalarField",name:"post_reshare_xma",storageKey:null}];return{fragment:{argumentDefinitions:[a,c,d],kind:"Fragment",metadata:null,name:"MAWFetchXMAData_LinkPreviewQuery",selections:e,type:"Query",abstractKey:null},kind:"Request",operation:{argumentDefinitions:[d,c,a],kind:"Operation",name:"MAWFetchXMAData_LinkPreviewQuery",selections:e},params:{id:b("MAWFetchXMAData_LinkPreviewQuery_facebookRelayOperation"),metadata:{},name:"MAWFetchXMAData_LinkPreviewQuery",operationKind:"query",text:null}}}();e.exports=a}),null);
__d("MAWUnshimUrl",["CometLinkShimUtils"],(function(a,b,c,d,e,f,g){"use strict";function a(a){if(a==null)return void 0;var b=d("CometLinkShimUtils").getLinkShimInfo(a,void 0,void 0,void 0,void 0,!0);return!b.shimmed?a:b.unshimmedHref}g.unshimUrl=a}),98);
__d("MAWFetchXMAData",["fbt","CometRelay","ConstUriUtils","FBLogger","LSXmaContentType","MAWFetchXMABlob","MAWFetchXMAData_LinkPreviewQuery.graphql","MAWGetImageSpec","MAWParseXMAFBConfig","MAWUnshimUrl","Promise","WAArmadilloXMA.pb","asyncToGeneratorRuntime","qex","sendToSentQPLLogger"],(function(a,b,c,d,e,f,g,h){"use strict";var i,j,k={failed_to_fetch_blob_for_xma_share:"Failed to fetch blob xma data for MAWShareAttachent",failed_to_fetch_json_for_xma_share:"Failed execute MAWShareAttachment_LinkPreviewQuery for MAWShareAttachent",failed_to_parse_json_for_xma_share:"Failed to fetch blob xma data for MAWShareAttachent"};function l(a){return{defaultCTA:{actionUrl:d("MAWUnshimUrl").unshimUrl(a),buttonType:d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_CTA_BUTTON_TYPE.OPEN_NATIVE,nativeUrl:d("MAWUnshimUrl").unshimUrl(a),title:h._("__JHASH__l7kNV274w6c__JHASH__").toString()},linkType:"internal",overlayIconGlyph:d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_OVERLAY_ICON_GLYPH.PRIVATE,preview_blob:void 0,title_text:h._("__JHASH__2usVu04y012__JHASH__").toString()}}function m(a){var b=Object.entries(c("LSXmaContentType")).find(function(b){var c=b[0];b=b[1];return a===b&&d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE[c]!=null});b=b!=null?d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE[b[0]]:void 0;if(b===void 0)return void 0;if(!d("MAWParseXMAFBConfig").isFBSupportedTargetType(b)){c("FBLogger")("messenger_web_sharing").mustfix("Unsupported XMA Target Type in sending path: "+b);return d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.FB_FEED_SHARE}return b}function n(a,b,c){return o.apply(this,arguments)}function o(){o=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,e,f){var g;try{g=JSON.parse(e)}catch(a){throw c("FBLogger")("messenger_web_sharing").catching(a).mustfixThrow(k.failed_to_parse_json_for_xma_share)}e=g;var h=e.action_url,i=e.ctas,l=e.default_cta_title,n=e.favicon_url,o=e.header_image_url,p=e.header_title,q=e.image_url,r=e.preview_url,s=e.subtitle_text,t=e.title_text;e=e.xma_content_type;var u=e;e=(yield (j||(j=b("Promise"))).all([[(n==null?void 0:n.startsWith("ls"))===!0?null:n,"favicon"],[q,"image"],[r,"preview"],[o,"header_image"]].map(function(a){return d("MAWFetchXMABlob").fetchBlob({descriptionForLogging:"MAWFetchXMAData_"+a[1],url:a[0],xmaContentType:u}).then(function(a){return(a=a)!=null?a:void 0})}))["catch"](function(a){f.forEach(function(a){d("sendToSentQPLLogger").markSendToSentFail(a,"failed_to_fetch_blob_for_xma_share")});c("FBLogger")("messenger_web_sharing").catching(a).mustfix(k.failed_to_fetch_blob_for_xma_share);return[void 0,void 0,void 0,void 0]}));n=e[0];q=e[1];r=e[2];o=e[3];e=i;i=m(u);var v=e==null?void 0:e[0];h=d("MAWUnshimUrl").unshimUrl((h=(h=h)!=null?h:v==null?void 0:v.action_url)!=null?h:a);a=d("MAWUnshimUrl").unshimUrl((v==null?void 0:v.native_url)!=null&&(v==null?void 0:v.native_url)!==""?v==null?void 0:v.native_url:h);h={actionUrl:h,buttonType:d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_CTA_BUTTON_TYPE.OPEN_NATIVE,nativeUrl:a,title:(v=l)!=null?v:void 0};return{ctas:e==null?void 0:e.map(function(a){return{actionUrl:d("MAWUnshimUrl").unshimUrl(a.action_url!=null&&a.action_url!==""?a.action_url:void 0),buttonType:d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_CTA_BUTTON_TYPE.OPEN_NATIVE,nativeUrl:d("MAWUnshimUrl").unshimUrl(a.native_url!=null&&a.native_url!==""?a.native_url:void 0),title:(a=a.title)!=null?a:void 0}}),defaultCTA:h,favicon_blob:n,header_image_blob:o,header_title:(a=p)!=null?a:void 0,image_blob:q,linkType:"internal",preview_blob:r,subtitle_text:(l=s)!=null?l:void 0,title_text:(v=t)!=null?v:void 0,xma_message_type:i}});return o.apply(this,arguments)}function p(a,e){return d("CometRelay").fetchQuery(a,i!==void 0?i:i=b("MAWFetchXMAData_LinkPreviewQuery.graphql"),{maxPreviewHeight:(a=c("qex")._("226"))!=null?a:void 0,maxPreviewWidth:(a=c("qex")._("226"))!=null?a:void 0,url:e}).toPromise()}function a(a,b,c){return q.apply(this,arguments)}function q(){q=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b,e){b=d("ConstUriUtils").getUri(b);b=b==null?void 0:(b=b.setSubDomain("www"))==null?void 0:b.toString();if(b==null)return{linkType:"unknown"};e.forEach(function(a){d("sendToSentQPLLogger").markSendToSentPoint(a,"fetch_json_for_xma_share_start")});a=(yield p(a,b)["catch"](function(a){e.forEach(function(b){d("sendToSentQPLLogger").markSendToSentFail(b,"failed_to_fetch_json_for_xma_share",a)}),c("FBLogger")("messenger_web_sharing").catching(a).mustfix(k.failed_to_fetch_json_for_xma_share)}));e.forEach(function(a){d("sendToSentQPLLogger").markSendToSentPoint(a,"fetch_json_for_xma_share_end")});if(a==null){e.forEach(function(a){d("sendToSentQPLLogger").addSendToSentAnnotations(a,{string:{xma_data_result:"empty"}})});return{linkType:"unknown"}}a=a.post_reshare_xma;if(a==null){e.forEach(function(a){d("sendToSentQPLLogger").addSendToSentAnnotations(a,{string:{xma_data_result:"external"}})});return{linkType:"external"}}if(a==="private"){e.forEach(function(a){d("sendToSentQPLLogger").addSendToSentAnnotations(a,{string:{xma_data_result:"private"}})});return l(b)}e.forEach(function(a){d("sendToSentQPLLogger").addSendToSentAnnotations(a,{string:{xma_data_result:"public"}})});return n(b,a,e)});return q.apply(this,arguments)}function e(a,b){return r.apply(this,arguments)}function r(){r=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,c){var e=a.favicon_blob,f=a.header_image_blob,g=a.overlayIconGlyph;a=a.preview_blob;a=a==null?void 0:new File([a],"preview",{type:a.type});e=e==null?void 0:new File([e],"favicon",{type:e.type});f=f==null?void 0:new File([f],"header",{type:f.type});g=g===d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_OVERLAY_ICON_GLYPH.PRIVATE?(j||(j=b("Promise"))).resolve({height:2,width:2}):a!=null?d("MAWGetImageSpec").getImageSpec_DEPRECATED(a):(j||(j=b("Promise"))).resolve();var h=e!=null?d("MAWGetImageSpec").getImageSpec_DEPRECATED(e):(j||(j=b("Promise"))).resolve(),i=f!=null?d("MAWGetImageSpec").getImageSpec_DEPRECATED(f):(j||(j=b("Promise"))).resolve();g=(yield (j||(j=b("Promise"))).all([g,h,i]));h=g[0];i=g[1];g=g[2];d("sendToSentQPLLogger").markSendToSentPoint(c,"preview_favicon_spec_ready");c=a==null||h==null?void 0:{file:a,height:h.height,width:h.width};a=e==null||i==null?void 0:{file:e,height:i.height,width:i.width};h=f==null||g==null?void 0:{file:f,height:g.height,width:g.width};return{faviconFileArgs:a,headerImageFileArgs:h,previewFileArgs:c}});return r.apply(this,arguments)}g.XMA_DATA_ERRORS=k;g.fetchXMAData=a;g.makeXMAFileArgs=e}),226);
__d("MAWSecureComposerText",["Lexical","LexicalText","MAWJids","MessengerLexicalEntityTextNode"],(function(a,b,c,d,e,f,g){"use strict";function a(a){return a.read(function(){var a=d("Lexical").$getRoot().getFirstChild();return a instanceof d("Lexical").ElementNode?a.getChildren().reduce(function(a,b){if(d("MessengerLexicalEntityTextNode").isMessengerLexicalEntityTextNode(b)){var c=b.getEntity();return a+("@"+d("MAWJids").toUserJid(c.id))}return a+b.getTextContent()},""):d("LexicalText").$rootTextContent()})}g.getTextFromEditorState=a}),98);
__d("MessengerIntent",["WebStorage","justknobx"],(function(a,b,c,d,e,f,g){"use strict";var h,i="mw_sent_message";function j(){return c("justknobx")._("1630")}function a(){(h||(h=c("WebStorage"))).setItemGuarded(h.getLocalStorage(),i,String(Date.now()))}function b(){var a=(h||(h=c("WebStorage"))).getLocalStorage();return Date.now()-Number(a==null?void 0:a.getItem(i))<j()}g.sentMessage=a;g.hasSentMessagesRecently=b}),98);
__d("MWLSLogSend",["CometHeroLogging","I64","MWChatInteraction","MWSharedMsgLogUtils","MessengerIntent"],(function(a,b,c,d,e,f,g){"use strict";var h;function a(a,b,e){var f=e.isCommunityEvent,g=e.isMessageRequest,i=e.source;e=e.threadType;var j=c("CometHeroLogging").genHeroInteractionUUIDAndMarkStart(a.getTraceId());d("MWChatInteraction").set(b,j);j={entrypoint:d("MWSharedMsgLogUtils").getEntrypointAnnotation(i),is_community_event:f===!0?"true":"false",is_message_request:g===!0?"true":"false",thread_type:e==null?"unknown":(h||(h=d("I64"))).to_string(e)};Object.entries(j).forEach(function(b){var c=b[0];b=b[1];a.addMetadata(c,String(b))});d("MessengerIntent").sentMessage();return a.onComplete(function(){delete d("MWChatInteraction").interactions[b]})}g.logSentHeroInteraction=a}),98);
__d("useMWSendAttachment",["$InternalEnum","CometMessengerShareGating","CometRelay","CometUnifiedShareSheetGating","FBLogger","JSResourceForInteraction","LSDatabaseSingleton","LSMessagingThreadAttributionType","MAWVerifyThreadCutoverDeferred","MWLSLogSend","MWVersion","MaybeUpdateTargetBasedOnODCutoverOrDefaultE2EEDeferred","WAResultOrError","asyncToGeneratorRuntime","cr:2898","cr:3536","gkx","isThreadLevelCutoverEnabled","qex","react","react-compiler-runtime","sendToSentQPLLogger"],(function(a,b,c,d,e,f,g){"use strict";var h,i;(h||d("react")).useCallback;var j=b("$InternalEnum").Mirrored(["USS_H_SCROLL","BCF"]);function k(){if(c("qex")._("77")===!0||c("qex")._("68")===!0)return!0;else return c("qex")._("121")===!0}var l=b("cr:2898")||b("cr:3536"),m=c("JSResourceForInteraction")("LSShareAttachment").__setRef("useMWSendAttachment");function a(){var a=d("react-compiler-runtime").c(2),e=d("CometRelay").useRelayEnvironment(),f;a[0]!==e?(f=function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var b,f=a.attachment,g=a.lssTraceApi,h=a.offlineMsgId,n=a.reshareTarget,o=a.s2sInstanceKey,p=a.secureXmaMessageType,q=a.sharingComponent,r=a.source,s=a.thread,t=a.xmaDataPromise,u=a.xmaDataProps;a=a.xmaMsgExternalId;var v=k(),w=v||c("isThreadLevelCutoverEnabled")();d("sendToSentQPLLogger").markSendToSentPoint(o,"update_target_deferred_component_load_start");var x=(yield c("MaybeUpdateTargetBasedOnODCutoverOrDefaultE2EEDeferred").load());d("sendToSentQPLLogger").markSendToSentPoint(o,"update_target_deferred_component_load_end");d("sendToSentQPLLogger").markSendToSentPoint(o,"update_target_start");x=(yield x(n,(i||(i=d("LSDatabaseSingleton"))).LSDatabaseSingleton,"sendAttachment",o));d("sendToSentQPLLogger").markSendToSentPoint(o,"update_target_end");f=x.targetID!==f.targetID?babelHelpers["extends"]({},f,{targetID:x.targetID}):f;d("MWLSLogSend").logSentHeroInteraction(g,h,{isMessageRequest:!1,mwVersion:d("MWVersion").v2,source:(b=r)!=null?b:c("LSMessagingThreadAttributionType").UNKNOWN,threadType:s==null?void 0:s.threadType});d("sendToSentQPLLogger").markSendToSentPoint(o,"offline_msg_id_generated");g.addMarkerPoint("offline_msg_id_generated","AppTiming");s=(b=x.isTargetE2E)!=null?b:v;b=!1;d("sendToSentQPLLogger").markSendToSentPoint(o,"verify_thread_cutover_start");g.addMarkerPoint("verify_thread_cutover_start","AppTiming");if(c("MAWVerifyThreadCutoverDeferred")!=null){d("sendToSentQPLLogger").markSendToSentPoint(o,"verify_cutover_deferred_component_load_start");v=(yield c("MAWVerifyThreadCutoverDeferred").load());v=v.verifyThreadCutoverWithStringInput;d("sendToSentQPLLogger").markSendToSentPoint(o,"verify_cutover_deferred_component_load_end");b=(yield v((i||(i=d("LSDatabaseSingleton"))).LSDatabaseSingleton,x.targetID))}d("sendToSentQPLLogger").markSendToSentPoint(o,"verify_thread_cutover_end");if(w&&s||b){if(l===null){c("gkx")("8783")||d("sendToSentQPLLogger").markSendToSentFail(o,"MAWShareAttachmentDeferred_null");g.addMarkerPoint("MAWShareAttachmentDeferred_null","AppTiming");throw c("FBLogger")("messenger_web_media").mustfixThrow("Failed to fetch MAWShareAttachmentDeferred")}d("sendToSentQPLLogger").markSendToSentPoint(o,"share_attachment_deferred_component_load_start");v=(yield l.load());w=v.shareSecureAttachment;d("sendToSentQPLLogger").markSendToSentPoint(o,"share_attachment_deferred_component_load_end");d("sendToSentQPLLogger").markSendToSentPoint(o,"share_secure_attachment_start");s=q===j.BCF&&d("CometMessengerShareGating").shouldEnableBCFSingleFetchXMA()||q===j.USS_H_SCROLL&&d("CometUnifiedShareSheetGating").shouldEnableUSSSingleFetchXMA();b=(yield w(s?void 0:e,f,x,r,o,p,"useMWSendAttachment",g,s?u:void 0,t,h,a));if((b==null?void 0:b.success)===!1)return d("WAResultOrError").makeError(b.error);else{d("sendToSentQPLLogger").markSendToSentPoint(o,"share_secure_attachment_end");return d("WAResultOrError").makeResult(x)}}else try{v=(yield m.load());q=v.share;yield q(f,o);return d("WAResultOrError").makeResult(n)}catch(a){w=a;throw w}});return function(b){return a.apply(this,arguments)}}(),a[0]=e,a[1]=f):f=a[1];return f}function e(){var a=d("react-compiler-runtime").c(2);if(a[0]===Symbol["for"]("react.memo_cache_sentinel")){var b=k()||!1;b=b||c("isThreadLevelCutoverEnabled")();a[0]=b}else b=a[0];var e=b;a[1]===Symbol["for"]("react.memo_cache_sentinel")?(b=function(a){if(c("gkx")("8694"))l==null?void 0:l.preload(),c("MAWVerifyThreadCutoverDeferred")==null?void 0:c("MAWVerifyThreadCutoverDeferred").preload(),c("MaybeUpdateTargetBasedOnODCutoverOrDefaultE2EEDeferred")==null?void 0:c("MaybeUpdateTargetBasedOnODCutoverOrDefaultE2EEDeferred").preload(),m.preload();else{((a=a)!=null?a:e)?(l==null?void 0:l.preload(),c("gkx")("8490")&&(c("MAWVerifyThreadCutoverDeferred")==null?void 0:c("MAWVerifyThreadCutoverDeferred").preload(),c("MaybeUpdateTargetBasedOnODCutoverOrDefaultE2EEDeferred")==null?void 0:c("MaybeUpdateTargetBasedOnODCutoverOrDefaultE2EEDeferred").preload())):m.preload()}},a[1]=b):b=a[1];return b}g.SharingComponentType=j;g.useMWSendAttachment=a;g.useMWPreloadSendAttachmentComponents=e}),98);