;/*FB_PKG_DELIM*/

__d("ExecTimeResolverHooks",["ReactiveExecutorExecTimeResolverTransformer","react-compiler-runtime","react-relay/relay-hooks/useFragment","react-relay/relay-hooks/useLazyLoadQuery","relay-runtime"],(function(a,b,c,d,e,f,g){function a(a,c){var e=d("react-compiler-runtime").c(3),f;e[0]!==a?(f=b("ReactiveExecutorExecTimeResolverTransformer").getTransformedQueryForExecTimeMode(a),e[0]=a,e[1]=f):f=e[1];e[2]===Symbol["for"]("react.memo_cache_sentinel")?(a={fetchPolicy:"store-and-network"},e[2]=a):a=e[2];return b("react-relay/relay-hooks/useLazyLoadQuery")(f,c,a)}function c(a,c){var e=d("react-compiler-runtime").c(2),f;e[0]!==a?(f=b("ReactiveExecutorExecTimeResolverTransformer").getTransformedFragmentForExecTimeMode(a),e[0]=a,e[1]=f):f=e[1];return b("react-relay/relay-hooks/useFragment")(f,c)}g.graphql=d("relay-runtime").graphql;g.useLazyLoadClientQuery=a;g.useFragment=c}),98);
__d("LSClearCommunityMembersRangeTable",[],(function(a,b,c,d,e,f){function a(){var a=arguments,b=a[a.length-1],c=[],d=[];return b.sequence([function(d){return a[1]!==void 0?c[0]=a[1]:c[0]="",b.i64.neq(a[0],void 0)?c[1]=!1:c[1]=!0,b.forEach(b.filter(b.db.table(189).fetch(),function(d){return(c[1]||b.i64.eq(d.source,a[0]))&&d.requestId===c[0]}),function(a){return a["delete"]()})},function(a){return b.resolve(d)}])}a.__sproc_name__="LSMailboxClearCommunityMembersRangeTableStoredProcedure";a.__tables__=["community_members_ranges_v2__generated"];e.exports=a}),null);
__d("LSClearCommunityMembersTable",[],(function(a,b,c,d,e,f){function a(){var a=arguments,b=a[a.length-1],c=[],d=[];return b.sequence([function(d){return a[1]!==void 0?c[0]=a[1]:c[0]="",b.i64.neq(a[0],void 0)?c[1]=!1:c[1]=!0,b.i64.neq(a[2],void 0)?b.forEach(b.filter(b.db.table(170).fetch(),function(d){return(c[1]||b.i64.eq(d.source,a[0]))&&b.i64.eq(d.groupThreadId,a[2])&&d.requestId===c[0]}),function(a){return a["delete"]()}):b.forEach(b.filter(b.db.table(170).fetch(),function(d){return(c[1]||b.i64.eq(d.source,a[0]))&&d.requestId===c[0]}),function(a){return a["delete"]()})},function(a){return b.resolve(d)}])}a.__sproc_name__="LSMailboxClearCommunityMembersTableStoredProcedure";a.__tables__=["community_members"];e.exports=a}),null);
__d("LSClearCommunityMembersAndRange",["LSClearCommunityMembersRangeTable","LSClearCommunityMembersTable"],(function(a,b,c,d,e,f){function a(){var a=arguments,c=a[a.length-1],d=[];return c.sequence([function(d){return c.sequence([function(d){return c.storedProcedure(b("LSClearCommunityMembersTable"),a[0],a[1],a[2])},function(d){return c.storedProcedure(b("LSClearCommunityMembersRangeTable"),a[0],a[1])}])},function(a){return c.resolve(d)}])}a.__sproc_name__="LSMailboxClearCommunityMembersAndRangeStoredProcedure";a.__tables__=[];e.exports=a}),null);
__d("LSClearCommunityMembersAndRangeStoredProcedure",["LSClearCommunityMembersAndRange","LSSynchronousPromise","Promise","cr:8709"],(function(a,b,c,d,e,f,g){var h;function a(a,e){e===void 0&&(e={});e=c("LSClearCommunityMembersAndRange")(e.source,e.requestId,e.threadId,a);return(h||(h=b("Promise"))).resolve(d("LSSynchronousPromise").maybeExtractValueIfSynchronousPromise(e))}g["default"]=a}),98);
__d("LSUpsertCommunityMemberRanges",["LSArrayGetObjectAt"],(function(a,b,c,d,e,f){function a(){var a=arguments,c=a[a.length-1],d=[],e=[];return c.sequence([function(e){return c.sequence([function(e){return d[0]=c.createArray(),d[3]=(d[0].push(c.i64.cast([0,0])),d[0]),a[2]===!0?c.resolve(d[1]=!0):c.sequence([function(e){return d[3]=!1,d[4]=c.i64.of_int32(a[1].length),c.i64.gt(d[4],c.i64.cast([0,0]))?c.loopAsync(d[4],function(e){return d[5]=e,c.sequence([function(e){return c.nativeTypeOperation("Array",b("LSArrayGetObjectAt"),a[1],d[5]).then(function(a){return a=a,d[6]=a[0],d[7]=a[1],a})},function(a){return d[3]=d[3]||c.i64.eq(c.i64.cast([0,1]),d[6])}])}):c.resolve()},function(a){return d[1]=d[3]}])},function(b){return a[9]!==void 0?d[2]=a[9]:d[2]="",c.db.table(189).put({communityId:a[0],isAdmin:d[1],minName:"",source:a[7],requestId:d[2],maxName:a[6],isLoadingBefore:!1,isLoadingAfter:a[4],hasMoreBefore:!1,hasMoreAfter:a[3],nextPageCursor:a[5]})}])},function(a){return c.resolve(e)}])}a.__sproc_name__="LSMailboxUpsertCommunityMemberRangesStoredProcedure";a.__tables__=["community_members_ranges_v2__generated"];e.exports=a}),null);
__d("LSIssueCommunityMemberListFetch",["LSIssueNewTask","LSUpsertCommunityMemberRanges"],(function(a,b,c,d,e,f){function a(){var a=arguments,c=a[a.length-1],d=[],e=[];return c.sequence([function(e){return c.sequence([function(e){return d[0]=c.createArray(),d[4]=(d[0].push(c.i64.cast([0,0])),d[0]),d[1]=c.createArray(),c.storedProcedure(b("LSUpsertCommunityMemberRanges"),a[0],a[1],a[2],!1,!0,"",a[5],a[6],a[9],a[11])},function(e){return d[2]=new c.Map(),d[2].set("community_id",a[0]),d[2].set("roles",a[1]),d[2].set("fetch_admins_only",a[2]),d[2].set("cursor",a[4]),d[2].set("source",a[6]),d[2].set("thread_key",a[7]),d[2].set("search_text",a[8]),d[2].set("thread_roles",a[9]),d[2].set("group_thread_id",a[10]),d[2].set("request_id",a[11]),d[3]=c.toJSON(d[2]),c.storedProcedure(b("LSIssueNewTask"),"fetch_community_member_list",c.i64.cast([0,355]),d[3],void 0,void 0,c.i64.cast([0,0]),c.i64.cast([0,0]),void 0,void 0,c.i64.cast([0,0]),c.i64.cast([0,0]))}])},function(a){return c.resolve(e)}])}a.__sproc_name__="LSMailboxIssueCommunityMemberListFetchStoredProcedure";a.__tables__=[];e.exports=a}),null);
__d("LSIssueCommunityMemberListFetchStoredProcedure",["LSIssueCommunityMemberListFetch","LSSynchronousPromise","Promise","cr:8709"],(function(a,b,c,d,e,f,g){var h;function a(a,e){e=c("LSIssueCommunityMemberListFetch")(e.communityId,e.roles,e.fetchAdminsOnly,e.fetchFriendMembersOnly,e.nextPageCursor,e.maxName,e.source,e.threadKey,e.searchText,e.threadRoles,e.groupThreadId,e.requestId,e.maxTimestampMs,a);return(h||(h=b("Promise"))).resolve(d("LSSynchronousPromise").maybeExtractValueIfSynchronousPromise(e))}g["default"]=a}),98);
__d("LSRelayHooks",["ExecTimeResolverHooks"],(function(a,b,c,d,e,f){"use strict";Object.keys(importNamespace("ExecTimeResolverHooks")).forEach(function(a){if(a==="default"||a==="__esModule")return;f[a]=importNamespace("ExecTimeResolverHooks")[a]})}),null);
__d("MAWQPLLogger",["QPLUserFlow","Random","cr:10049"],(function(a,b,c,d,e,f,g){"use strict";b("cr:10049")==null?void 0:b("cr:10049").overwriteSamplingRate();function a(a){return{addQPLAnnotations:function(b,d){c("QPLUserFlow").addAnnotations(a,d,{instanceKey:b})},markQPLCancel:function(b){c("QPLUserFlow").endCancel(a,{instanceKey:b})},markQPLFailure:function(b,d){var e;c("QPLUserFlow").endFailure(a,(e=d==null?void 0:d.name)!=null?e:"fail",{error:d,instanceKey:b})},markQPLFailureWithMsg:function(b,d){c("QPLUserFlow").endFailure(a,d,{instanceKey:b})},markQPLPoint:function(b,d,e){c("QPLUserFlow").addPoint(a,d,{debugInfo:e,instanceKey:b})},markQPLStart:function(){var b=Date.now()+(Math.round(d("Random").random()*1e4)+1e4);c("QPLUserFlow").start(a,{instanceKey:b});return b},markQPLSuccess:function(b){c("QPLUserFlow").endSuccess(a,{instanceKey:b})}}}g["default"]=a}),98);
__d("MAWDataSourceLogger",["I64","MAWQPLLogger","qpl"],(function(a,b,c,d,e,f,g){"use strict";var h,i;function j(){i==null&&(i=c("MAWQPLLogger")(c("qpl")._(25303796,"1974")));return i}function a(a){var b=j().markQPLStart();j().addQPLAnnotations(b,{string:{threadType:(h||(h=d("I64"))).to_string(a)}});return b}function b(a,b,c){j().markQPLPoint(a,"wait_act_thread_start","before fetching messages range from table"),j().addQPLAnnotations(a,{"int":{version:1},string:{direction:b,thread_id:(h||(h=d("I64"))).to_string(c)}})}function e(a,b){j().markQPLFailureWithMsg(a,b)}function f(a){j().markQPLCancel(a)}function k(a){j().markQPLPoint(a,"wait_act_thread_end","before fetching messages range from table"),j().markQPLPoint(a,"load_more_msgs_start","load more messages from MAW DB")}function l(a){j().markQPLPoint(a,"load_messages_from_eb_start","load more messages from EB")}function m(a){j().markQPLPoint(a,"load_messages_from_eb_end","load more messages from EB")}function n(a){j().markQPLPoint(a,"load_messages_from_local_db_start")}function o(a){j().markQPLPoint(a,"load_messages_from_local_db_end")}function p(a){j().markQPLPoint(a,"insert_msgs_to_lsdb_start")}function q(a){j().markQPLPoint(a,"insert_msgs_to_lsdb_end")}function r(a){j().markQPLPoint(a,"insert_msgs_to_lsdb_dispatch_download_state_updates_start")}function s(a){j().markQPLPoint(a,"insert_msgs_to_lsdb_dispatch_download_state_updates_end")}function t(a){j().markQPLPoint(a,"insert_msgs_to_lsdb_call_bridge_handlers_start")}function u(a){j().markQPLPoint(a,"insert_msgs_to_lsdb_call_bridge_handlers_end")}function v(a,b){j().markQPLPoint(a,"load_more_msgs_end","Note: OLD SOLUTION DOES NOT FETCH messages. they are fetched in afterTransaction that we cannot control"),j().addQPLAnnotations(a,{bool:{hasMoreBefore:b}})}function w(a){j().markQPLSuccess(a)}function x(a,b){j().markQPLPoint(a,"issued_range_query","MAWFetchSecureMessages: minMsgSortOrderTsResponse "+b)}function y(a,b){j().markQPLFailure(a,b)}g.logLoadMoreMsgsStart=a;g.logLoadMoreMsgsThreadWaiting=b;g.logLoadMoreMsgsFailure=e;g.logLoadMoreMsgsCancel=f;g.logLoadMoreMsgsThreadReadyFetchMsgs=k;g.logLoadMessagesFromEBStart=l;g.logLoadMessagesFromEBEnd=m;g.logLoadMessagesFromLocalDBStart=n;g.logLoadMessagesFromLocalDBEnd=o;g.logInsertMessageResponseToLSDBStart=p;g.logInsertMessageResponseToLSDBEnd=q;g.logDispatchDownloadStateUpdatesStart=r;g.logDispatchDownloadStateUpdatesEnd=s;g.logCallBridgeHandlersStart=t;g.logCallBridgeHandlersEnd=u;g.logLoadMoreMsgsFetched=v;g.logLoadMoreMsgsSuccess=w;g.logLoadMoreMsgsRangeQuery=x;g.logLoadMoreMsgsRuntimeError=y}),98);
__d("MAWEBDeanonFetch",["EBAPI","FBLogger","WAJids","WAResultOrError","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";function a(a){return h.apply(this,arguments)}function h(){h=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var b=a.chatJid,e=a.count,f=a.direction,g=a.includeReferenceTimestamp,h=a.referenceTimestampMs;a=a.sortFn;try{f=(yield c("EBAPI").messageMetadataQuery({direction:f,includeAnonymizedMessages:!1,numberOfMessages:e,referenceTimestamp:h,threadId:d("WAJids").threadIdForChatJid(b)}));if(f.success===!1)return d("WAResultOrError").makeError("error",f.payload);e=f.value.messages;b=e.reduce(function(a,b){var c=b.offlineThreadingId;b=b.sortOrderMs;if(c==null||b==null)return a;b=Number(b);return g!==!0&&b===h?a:[].concat(a,[{externalId:c,msgType:"unknown-deanon",sortOrderMs:b}])},[]);f=a==null?b:b.sort(a);return d("WAResultOrError").makeResult(f)}catch(a){c("FBLogger")("messenger_web_missing_messages").catching(a).mustfix("Deanon GraphQL fails with error");return d("WAResultOrError").makeError("request-error",a.message)}});return h.apply(this,arguments)}g.fetchMessagesMetadataFromEBDeanon=a}),98);
__d("MWRestoreMessagesFromEB",["EBAPI","I64","LSAppendDataTraceAddonStoredProcedure","LSDataTraceCheckPoint","LSDataTraceType","LSEncryptedBackupsBackupTenancy","LSFactory","LSIntEnum","LSIssueMessageRangeQueryTaskStoredProcedure","LSMEBTaskCreationSource","MAWAsyncEBPendingQueryPromise","MAWEBRestoreTrackingUtils","MAWEncryptedBackupUtils","MAWMainTraceUtils","MWEncryptedBackUpEBNotEnabledError","Promise","WAJids","WATagsLogger","asyncToGeneratorRuntime","err","gkx","promiseDone"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j;function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web][","] Issuing message range query for thread: "," startSortKey: "," numMessages: ","} "]);k=function(){return a};return a}function l(){var a=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] Issuing message range query for chatJid: "," skipped. EB not enabled"]);l=function(){return a};return a}function a(a){var e=a.chatJid,f=a.newerNumMessages,g=a.numMessages,k=a.passedTraceId,n=a.sortOrderMs,o=a.source,p=a.storage;if(!c("gkx")("23914"))return null;var q=k!=null?k:d("MAWMainTraceUtils").createTraceId();c("promiseDone")(d("MAWEncryptedBackupUtils").getBackupTenancy(p.tables).then(function(a){if(a!=null&&(i||(i=d("I64"))).equal(a,(j||(j=d("LSIntEnum"))).ofNumber(c("LSEncryptedBackupsBackupTenancy").PRODUCTION))){a=c("gkx")("5976");return a?c("EBAPI").messageRangeQueryWithPersistence({chatJid:e,direction:(i||(i=d("I64"))).to_float(f)>0?"after":"before",includeOffset:c("gkx")("5340"),instanceKey:q,sortOrderMs:(i||(i=d("I64"))).to_string(n),source:o}):m({chatJid:e,newerNumMessages:f,numMessages:g,passedTraceId:k,sortOrderMs:n,source:o,storage:p,traceId:q})}else{d("WATagsLogger").TAGS(["labyrinth_web","eb_restore"]).WARN(l(),e);d("MAWAsyncEBPendingQueryPromise").rejectPendingQueryIfPresent(q,c("err")(d("MWEncryptedBackUpEBNotEnabledError").EB_NOT_ENABLED));return(h||(h=b("Promise"))).resolve()}}));return q}function m(a){var e=a.chatJid,g=a.newerNumMessages,h=a.numMessages,l=a.passedTraceId,m=a.sortOrderMs,n=a.source,o=a.storage,p=a.traceId;return o.runInTransaction(function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){yield d("MAWMainTraceUtils").startTraceWithTxn(a,(i||(i=d("I64"))).of_float(Date.now()),p,(j||(j=d("LSIntEnum"))).ofNumber(c("LSDataTraceType").ENCRYPTED_BACKUPS_RESTORE));yield c("LSAppendDataTraceAddonStoredProcedure")(c("LSFactory")(a),{checkPointId:j.ofNumber(c("LSDataTraceCheckPoint").LABYRINTH_WEB_ISSUE_MESSAGE_RANGE_QUERY),dataTraceId:p,syncChannel:i.neg_one});d("WATagsLogger").TAGS(["labyrinth_web","eb_restore",p]).LOG(k(),p,e,i.to_string(m),i.to_string(h));d("MAWEBRestoreTrackingUtils").markEBRestorePaginated(n,l,"LS");return c("LSIssueMessageRangeQueryTaskStoredProcedure")(c("LSFactory")(a),{includeOffset:c("gkx")("5340"),isPointQuery:!1,newerNumMessages:g,numMessages:h,source:j.ofNumber((a=n)!=null?a:c("LSMEBTaskCreationSource").UNKNOWN),startSortKey:i.to_string(m),threadId:d("WAJids").threadIdForChatJid(e),traceId:p})});return function(b){return a.apply(this,arguments)}}(),"readwrite",void 0,void 0,f.id+":126")}g["default"]=a}),98);
__d("MAWEBFetch",["EBFormatUtils","FBLogger","I64","LSMEBTaskCreationSource","MAWAsyncEBPendingQueryPromise","MWEncryptedBackUpEBNotEnabledError","MWRestoreMessagesFromEB","WAResultOrError","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";var h;function a(a){return i.apply(this,arguments)}function i(){i=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var b=a.chatJid,e=a.count,f=a.db,g=a.direction,i=a.skipFullRestore;i=i===void 0?!1:i;var j=a.timestampMs;a=a.traceId;e=d("EBFormatUtils").adjustCount(e,g);var k=e[0];e=e[1];b=c("MWRestoreMessagesFromEB")({chatJid:b,newerNumMessages:(h||(h=d("I64"))).of_int32(e),numMessages:h.of_int32(k),passedTraceId:a,sortOrderMs:d("EBFormatUtils").adjustTs(j,g),source:c("LSMEBTaskCreationSource").MESSENGER_MESSAGE_LIST_PAGINATION,storage:f});if(b==null)return d("WAResultOrError").makeResult({hasMoreAfter:!1,hasMoreBefore:!1,messages:[],restoreType:"none"});e=i?d("MAWAsyncEBPendingQueryPromise").getPendingQueryPromiseFromTrace(b):d("MAWAsyncEBPendingQueryPromise").getWaitForRestorePromiseFromTrace(b);k=(yield e.then(function(a){return d("WAResultOrError").makeResult(a)})["catch"](function(a){if(a&&(a==null?void 0:a.message)===d("MWEncryptedBackUpEBNotEnabledError").EB_NOT_ENABLED)return d("WAResultOrError").makeError(d("MWEncryptedBackUpEBNotEnabledError").EB_NOT_ENABLED);c("FBLogger")("messenger_e2ee_web").catching(a).mustfix("[EBFetch] Failed to fetch");return d("WAResultOrError").makeError((a=a==null?void 0:a.message)!=null?a:"unknown")}));if(k.success===!1)return k;a=k.value;j=a.hasMoreAfter;g=a.hasMoreBefore;f=a.messages;i=a.restoreType;return d("WAResultOrError").makeResult({hasMoreAfter:j,hasMoreBefore:g,messages:f,restoreType:i})});return i.apply(this,arguments)}g["default"]=a}),98);
__d("MAWPutMessagesToDB",["MAWBridgeDeleteReactionHandler","MAWBridgeMsgsStartCountdownHandler","MAWBridgeNewMediaHandler","MAWBridgeNewMsgHandler","MAWBridgeNewReceiverFetchInfoHandler","MAWBridgeNewXMAHandler","MAWBridgeReactionUpsertHandler","MAWDataSourceLogger","MAWGetIsMediaDownloadStatusEnabled","Promise","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";var h;function i(a,b,c,d){return j.apply(this,arguments)}function j(){j=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,c,e,f){var g=c.expiringCountdown,i=c.medias,j=c.msgs,k=c.reactions,l=c.receiverFetchInfoPayloads;c=c.xmas;f!=null&&d("MAWDataSourceLogger").logDispatchDownloadStateUpdatesStart(f);d("MAWGetIsMediaDownloadStatusEnabled").getIsMediaDownloadStatusEnabled()&&e({tag:"NewMedias",value:i});d("MAWGetIsMediaDownloadStatusEnabled").getIsMediaDownloadStatusForXMAsEnabled()&&e({tag:"NewXMAs",value:c});f!=null&&(d("MAWDataSourceLogger").logDispatchDownloadStateUpdatesEnd(f),d("MAWDataSourceLogger").logCallBridgeHandlersStart(f));yield d("MAWBridgeNewMsgHandler").bulkCall(a,j);yield (h||(h=b("Promise"))).all(i.map(function(b){return d("MAWBridgeNewMediaHandler").call(a,b)}));yield h.all(c.map(function(b){return d("MAWBridgeNewXMAHandler").call(a,b)}));yield h.all(l.map(function(b){return d("MAWBridgeNewReceiverFetchInfoHandler").call(a,b)}));yield d("MAWBridgeMsgsStartCountdownHandler").call(a,{msgs:g});yield h.all(k.map(function(b){return b.type==="delete"?d("MAWBridgeDeleteReactionHandler").call(a,b.reaction):d("MAWBridgeReactionUpsertHandler").call(a,b.reaction)}));f!=null&&d("MAWDataSourceLogger").logCallBridgeHandlersEnd(f)});return j.apply(this,arguments)}function a(a,b,c,d){return a.runInTransaction(function(a){return i(a,b,c,d)},"readwrite","ui",void 0,f.id+":104")}function c(a,b,c){return a.runInTransaction(function(a){return i(a,babelHelpers["extends"]({},b,{expiringCountdown:[],hasMoreAfter:!1,hasMoreBefore:!1}),c)},"readwrite","ui",void 0,f.id+":123")}g.insertMessageResponseToDBInExistingTransaction=i;g.insertMessageResponseIntoDatabase=a;g.insertMessageResponseIntoDatabaseByExternalId=c}),98);
__d("MAWSecureLocalDBFetch",["CometLruCache","FBLogger","I64","MAWBridgeSendAndReceive","MAWDbMsg","WAResultOrError","asyncToGeneratorRuntime","deepEquals"],(function(a,b,c,d,e,f,g){"use strict";var h,i=d("CometLruCache").create(20,2e3);function a(a,b){return j.apply(this,arguments)}function j(){j=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b){var e=a.actionType,f=a.chatJid,g=a.config,j=a.count,k=a.direction,l=a.offsetMsg;a=a.timestampMs;var m=i.get(f);if(m!=null){var n=m&&m.options,o=n.count;n=babelHelpers.objectWithoutPropertiesLoose(n,["count"]);if(c("deepEquals")(n,{config:g,direction:k,offsetMsg:l,timestampMs:a})&&j<=o)try{return d("WAResultOrError").makeResult(babelHelpers["extends"]({},yield m.result))}catch(a){}}try{o=d("MAWBridgeSendAndReceive").sendAndReceive("backend","maw_load_msgs",{actionType:e,chatJid:f,config:g,direction:k,includeOriginalMsg:(n=l==null?void 0:l.includeOriginalMsg)!=null?n:!1,msgId:(l==null?void 0:l.messageId)==null?null:d("MAWDbMsg").toMsgId(l.messageId),numMsgs:j,sortOrderMs:a!=null?(h||(h=d("I64"))).to_float(a):null},{timeoutMs:b==null?void 0:b.timeoutMs});i.set(f,{options:{config:g,count:j,direction:k,offsetMsg:l,timestampMs:a},result:o});m=babelHelpers["extends"]({},yield o);return d("WAResultOrError").makeResult(m)}catch(a){c("FBLogger")("messenger_e2ee_web").catching(a).mustfix("[MAWSecureLocalDBFetch] maw_load_msgs bridge call failed");return d("WAResultOrError").makeError("bridge_call_failed",a)}});return j.apply(this,arguments)}g["default"]=a}),98);
__d("MLV2DataSourceLogger",["I64","MAWQPLLogger","interaction-tracing","mergeDeep","nullthrows","performanceNow","qpl"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j;function k(){j==null&&(j=c("MAWQPLLogger")(c("qpl")._(25303796,"1974")));return j}var l=new Map();function m(a,b){return(i||(i=d("I64"))).to_string(a)+b}function a(a,b,e,f){var g=m(a,b);if(l.has(g))return c("nullthrows")(l.get(g));var j=k().markQPLStart(),n=c("interaction-tracing").InteractionTracingCore.getPendingInteractions(),p=(h||(h=c("performanceNow")))(),q=function(a,b){var d=(h||(h=c("performanceNow")))(),e={action:a,full_duration:(d-p)/1e3};b!=null&&(e=c("mergeDeep")(e,b));n.forEach(function(a){a.addSubspan("MLV2_fetch","AppTiming",p,d,e)})},r=new Set(),s={addQPLAnnotations:function(a){k().addQPLAnnotations(j,a)},annotateMessageRangesDataSource:function(a){r.add(a),k().addQPLAnnotations(j,{string_array:{message_ranges_source:Array.from(r.keys())}})},getInstanceKey:function(){return j},markQPLCancel:function(){k().markQPLCancel(j),q("CANCEL"),l["delete"](g)},markQPLFailure:function(a){k().markQPLFailure(j,a),q("FAIL"),l["delete"](g)},markQPLFailureWithMsg:function(a){k().markQPLFailureWithMsg(j,a),q("FAIL"),l["delete"](g)},markQPLPoint:function(a){k().markQPLPoint(j,a)},markQPLSuccess:function(a){k().markQPLSuccess(j),q("SUCCESS",{num_msgs_fetched:a}),l["delete"](g)}};s.addQPLAnnotations({string:{thread_type:(i||(i=d("I64"))).to_string(f)}});l.set(g,s);o(b,e,a);return s}function n(a,b){a=m(a,b);return l.get(a)}function o(a,b,c){var e;(e=n(c,a))==null?void 0:e.addQPLAnnotations({"int":{queried_count:b},string:{direction:a,thread_id:(i||(i=d("I64"))).to_string(c)}})}g.startMLV2LoggerForThread=a;g.getMLV2LoggerForThread=n}),98);
__d("MAWSecureLocalDBDataSource",["I64","MAWBridgeSendAndReceive","MAWDataSourceLogger","MAWDbMsg","MAWIsEBEnabled","MAWMiActOnActThreadReady","MAWPutMessagesToDB","MAWSecureDataSource","MAWSecureLocalDBFetch","MLV2DataSourceLogger","MWEncryptedBackUpEBNotEnabledError","Promise","ReQL","WAResultOrError","WAStanzaUtils","WATagsLogger","asyncToGeneratorRuntime","err","gkx","justknobx","requireDeferred"],(function(a,b,c,d,e,f,g){"use strict";var h,i;function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["Fetching "," messages by external id, which is not optimal.\n      Consider migrating 'loadMsgsByExternalId' backend request to a batch version "]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["Failed to fetch messages: ",""]);k=function(){return a};return a}function l(){var a=babelHelpers.taggedTemplateLiteralLoose(["useFetchSecureMessages: threadJid: "," minMsgSortOrderTsResponse ",""]);l=function(){return a};return a}function m(){var a=babelHelpers.taggedTemplateLiteralLoose(["Fetch more: ",""]);m=function(){return a};return a}var n=c("requireDeferred")("MAWEBFetch").__setRef("MAWSecureLocalDBDataSource"),o=d("WATagsLogger").TAGS(["MAWSecureLocalDBDataSource"]);function p(a,b,c,d){return q.apply(this,arguments)}function q(){q=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,e,f,g){var h=(yield d("MAWIsEBEnabled").isEbEnabled(a));return!h?(i||(i=b("Promise"))).resolve(d("WAResultOrError").makeError(d("MWEncryptedBackUpEBNotEnabledError").EB_NOT_ENABLED)):(i||(i=b("Promise"))).race([n.load().then(function(b){return b({chatJid:e,count:g,db:a,direction:"before",timestampMs:f})}),new i(function(a){return window.setTimeout(function(){return a(d("WAResultOrError").makeError("timeout"))},c("justknobx")._("2569"))})])});return q.apply(this,arguments)}function r(a){return a.msgs.map(function(a){return{externalId:a.externalId,msgType:a.type_,sortOrderMs:a.sortOrderMs}})}a=function(){function a(){this.$1=!1}var e=a.prototype;e.$2=function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,e,g,i,j,k,q,r,s){if(j==="after")return;j;o.LOG(m(),e);d("MAWDataSourceLogger").logLoadMoreMsgsThreadWaiting(q,"before",e);j=(yield d("MAWMiActOnActThreadReady").waitForACTThreadReady(a.tables,e,"MAWFetchMoreMessages"));j=j.chatJid;d("MAWDataSourceLogger").logLoadMoreMsgsThreadReadyFetchMsgs(q);var t=c("gkx")("1560");if(!this.$1&&t){d("MAWDataSourceLogger").logLoadMessagesFromEBStart(q);var u=(yield p(a,j,g,k));u.success===!1&&u.error==="timeout"&&(this.$1=!0);d("MAWDataSourceLogger").logLoadMessagesFromEBEnd(q)}d("MAWDataSourceLogger").logLoadMessagesFromLocalDBStart(q);u=(yield c("MAWSecureLocalDBFetch")({actionType:r,chatJid:j,config:{admin:!0,editMsgHistory:!0,media:!0,reactions:!0,receiverFetch:!0,xma:!0},count:k,direction:"before",offsetMsg:{includeOriginalMsg:!1,messageId:i.minMessageId},timestampMs:g}));if(u.success===!1){throw(r=u.payload)!=null?r:c("err")(u.error)}var v=u.value;d("MAWDataSourceLogger").logLoadMessagesFromLocalDBEnd(q);d("MAWDataSourceLogger").logInsertMessageResponseToLSDBStart(q);var w=v.msgs.length>0?v.msgs[v.msgs.length-1].msgId:i.minMessageId;yield a.runInTransaction(function(){var c=b("asyncToGeneratorRuntime").asyncToGenerator(function*(b){var c;yield d("MAWPutMessagesToDB").insertMessageResponseToDBInExistingTransaction(b,v,s,q);c=(yield (c=b.messages_ranges_v2__generated).get.apply(c,[i.threadKey,i.minTimestampMs,i.minMessageId]));if(c==null)return;var e=v.hasMoreBefore;v.hasMoreBefore===!1&&!t&&(yield d("MAWIsEBEnabled").isEbEnabled(a))&&(e=!0);yield b.messages_ranges_v2__generated.upsert([c.threadKey,c.minTimestampMs,c.minMessageId],{hasMoreAfter:!1,hasMoreBefore:e,isLoadingAfter:!1,isLoadingBefore:!1,maxMessageId:c.maxMessageId,maxTimestampMs:c.maxTimestampMs,minMessageId:w,minTimestampMs:(h||(h=d("I64"))).zero,threadKey:i.threadKey})});return function(a){return c.apply(this,arguments)}}(),"readwrite","ui",void 0,f.id+":203");d("MAWDataSourceLogger").logInsertMessageResponseToLSDBEnd(q);d("MAWDataSourceLogger").logLoadMoreMsgsFetched(q,v.hasMoreBefore);if(v.hasMoreBefore){d("MAWDataSourceLogger").logLoadMoreMsgsSuccess(q);return}g=(yield d("MAWBridgeSendAndReceive").sendAndReceive("backend","getMaybeNextNonAdminMsgSortOrderMs",{chatJid:j,mayBeAdminMsgId:d("MAWDbMsg").toMsgId(i.minMessageId)}));d("WATagsLogger").TAGS(["labyrinth_web","useFetchSecureMessages"]).LOG(l(),j,g.minMsgTimestampMs);d("MAWDataSourceLogger").logLoadMoreMsgsRangeQuery(q,g.minMsgTimestampMs);r=(yield n.load());u=(yield r({chatJid:j,count:k,db:a,direction:"before",timestampMs:(h||(h=d("I64"))).of_float(g.minMsgTimestampMs)}));u.success&&u.value.hasMoreBefore===!1&&(yield a.runInTransaction(function(){var c=b("asyncToGeneratorRuntime").asyncToGenerator(function*(b){var c=i.minTimestampMs,f=(yield d("ReQL").firstAsync(d("ReQL").fromTableDescending(a.tables.messages_ranges_v2__generated).getKeyRange(e).bounds({lte:[c]}).filter(function(a){var b=a.maxTimestampMs;a=a.minTimestampMs;return(h||(h=d("I64"))).ge(c,a)&&(h||(h=d("I64"))).le(c,b)})));if(f==null)return;yield b.messages_ranges_v2__generated.upsert([f.threadKey,f.minTimestampMs,f.minMessageId],babelHelpers["extends"]({},f,{hasMoreBefore:!1,isLoadingBefore:!1}))});return function(a){return c.apply(this,arguments)}}(),"readwrite","ui",void 0,f.id+":288"));d("MAWDataSourceLogger").logLoadMoreMsgsSuccess(q)});function e(b,c,d,e,f,g,h,i,j){return a.apply(this,arguments)}return e}();e.requestMessages=function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b,e,f,g,h,i,j){j=(yield c("MAWSecureLocalDBFetch")({actionType:j,chatJid:b,config:i,count:(a=h)!=null?a:d("MAWSecureDataSource").DEFAULT_NUM_MESSAGES,direction:g,offsetMsg:f==null?null:{includeOriginalMsg:!1,messageId:f},timestampMs:e}));if(j.success===!1){throw(b=j.payload)!=null?b:c("err")(j.error)}i=j.value;h=i.msgs.map(function(a){return{externalId:a.externalId,msgType:a.type_,sortOrderMs:a.sortOrderMs}});return{hasMoreAfter:i.hasMoreAfter,hasMoreBefore:i.hasMoreBefore,msgs:h}});function e(b,c,d,e,f,g,h,i){return a.apply(this,arguments)}return e}();e.fetchSecureMessagesProtocol=function(a,b,c,e,f,g,h,i,j){h===void 0&&(h=d("MAWSecureDataSource").DEFAULT_NUM_MESSAGES);c=d("MAWDataSourceLogger").logLoadMoreMsgsStart(c);return this.$2(a,b,e,f,g,h,c,i,j)["catch"](function(a){var c;o.ERROR(k(),a);(c=d("MLV2DataSourceLogger").getMLV2LoggerForThread(b,g))==null?void 0:c.markQPLFailure(a)})};e.fetchMessagesByExternalId=function(a,c){a.length>2&&o.WARN(j(),a.length);a=a.map(function(a){return d("MAWBridgeSendAndReceive").sendAndReceive("backend","loadMsgsByExternalId",{config:c,externalId:d("WAStanzaUtils").toStanzaId(a)})});return(i||(i=b("Promise"))).all(a).then(function(a){return a.map(function(a){return r(a)}).flat()})};e.getMessagesCount=function(a,b,c,e,f){return d("MAWBridgeSendAndReceive").sendAndReceive("backend","getMsgsCount",{chatJid:a,direction:e,maxNumMsgs:c,offsetMsgId:d("MAWDbMsg").toMsgId(b),sortOrderMsLimit:f}).then(function(a){return babelHelpers["extends"]({},a)})};return a}();g["default"]=a}),98);
__d("MWChatComposerMentionsViewItem.react",["CometImageFromIXValue.react","CometSearchMentionsBaseViewItem.react","FDSIcon.react","FDSProfilePhoto.react","FDSTextPairing.react","react","react-compiler-runtime"],(function(a,b,c,d,e,f,g){"use strict";var h,i=h||d("react"),j={image:{height:"x1fgtraw",width:"xgd8bvy",$$css:!0}};function a(a){var b=d("react-compiler-runtime").c(18),e,f;b[0]!==a?(e=a.entry,f=babelHelpers.objectWithoutPropertiesLoose(a,["entry"]),b[0]=a,b[1]=e,b[2]=f):(e=b[1],f=b[2]);a=e;var g=a.handle,h=a.key,k=a.label;a=a.rawData;var l=a.icon,m=a.image,n=a.photoURI;a=a.subtitle;var o;if(n!=null){var p;b[3]!==n?(p=i.jsx(c("FDSProfilePhoto.react"),{size:28,source:{uri:n}}),b[3]=n,b[4]=p):p=b[4];o=p}else if(l!=null){b[5]!==l?(n=i.jsx(c("FDSIcon.react"),{color:"primary",disabled:!1,icon:l}),b[5]=l,b[6]=n):n=b[6];o=n}else if(m!=null){b[7]!==m?(p=i.jsx(c("CometImageFromIXValue.react"),{source:m,xstyle:j.image}),b[7]=m,b[8]=p):p=b[8];o=p}n="mention("+((l=g)!=null?l:h)+")";b[9]!==k||b[10]!==a?(m=i.jsx(c("FDSTextPairing.react"),{body:k,bodyLineLimit:1,level:3,meta:a,metaLineLimit:1}),b[9]=k,b[10]=a,b[11]=m):m=b[11];b[12]!==e||b[13]!==o||b[14]!==f||b[15]!==n||b[16]!==m?(p=i.jsx(c("CometSearchMentionsBaseViewItem.react"),babelHelpers["extends"]({},f,{entry:e,itemStartContent:o,testid:void 0,children:m})),b[12]=e,b[13]=o,b[14]=f,b[15]=n,b[16]=m,b[17]=p):p=b[17];return p}g["default"]=a}),98);
__d("MWChatComposerMentionsUtils",["remove-accents"],(function(a,b,c,d,e,f,g){"use strict";function a(a,b){if(b.length===0)return!0;var d=c("remove-accents")(b).toLowerCase();b=c("remove-accents")(a).toLowerCase();return b.split(" ").some(function(a){return a.startsWith(d)})||b.startsWith(d)}g.doesParticipantNameMatch=a}),98);
__d("MWChatComposerTypeaheadUtil",["fbt","ix","MWChatComposerMentionsUtils","gkx"],(function(a,b,c,d,e,f,g,h,i){"use strict";var j=h._("__JHASH__5zKX9L3wCmC__JHASH__").toString(),k={decorType:"regular",handle:j,key:"0",label:j,rawData:{image:i("391426"),subtitle:void 0},type:"entry"};function a(a,b,e,f,g,i,l){var m=a.query,n=[];g===!0&&d("MWChatComposerMentionsUtils").doesParticipantNameMatch(j,m)&&n.push(k);if(g===!0?i:!0){b.forEach(function(a){var b=a.actualName,c=a.contactId,e=a.nickname,f=a.profilePictureUrl;a=a.secondaryName;var g=null;a!=null&&d("MWChatComposerMentionsUtils").doesParticipantNameMatch(a,m)?g="secondaryName":d("MWChatComposerMentionsUtils").doesParticipantNameMatch(b,m)?g="name":e!=null&&d("MWChatComposerMentionsUtils").doesParticipantNameMatch(e,m)&&(g="nickname");if(g!=null&&f!=null){var h;n.push({decorType:"regular",handle:(h=a)!=null?h:g==="nickname"?(h=e)!=null?h:b:b,key:c+" "+g,label:b,rawData:{photoURI:f,source:g,subtitle:(h=a)!=null?h:e},type:"entry"})}});if(c("gkx")("24051")){g=h._("__JHASH__sTLNkkV9rF7__JHASH__").toString();if(d("MWChatComposerMentionsUtils").doesParticipantNameMatch(g,m)){i=h._("__JHASH__rLeo5-LqefI__JHASH__").toString();n.push({decorType:"regular",handle:g,key:""+e,label:g,rawData:{source:"all",subtitle:i},type:"entry"})}b=h._("__JHASH__qb09B47tS-j__JHASH__").toString();if(d("MWChatComposerMentionsUtils").doesParticipantNameMatch(b,m)){g=h._("__JHASH__Y9cD1qBx4DO__JHASH__").toString();n.push({decorType:"regular",handle:b,key:e+"-active",label:b,rawData:{source:"all",subtitle:g},type:"entry"})}}}n.length>l&&(n=n.slice(0,l));n.length<l&&f&&f(m,l-n.length);return{entries:n,params:a}}var l=(e={},e[j]="ai",e);function b(a){a=l[a];return a==null?"p":a}g.aiBotMentionsEntry=k;g.fetchCacheComposerMentionsTypeahead=a;g.commandToRangeType=b}),226);
__d("MessengerLexicalActorNode",["MWChatComposerTypeaheadUtil","MessengerLexicalEntityTextNode","gkx"],(function(a,b,c,d,e,f,g){"use strict";function h(a){a=a.replace(" name","");a=a.replace(" nickname","");a=a.replace(" secondaryName","");return a}var i=function(b){babelHelpers.inheritsLoose(a,b);a.getType=function(){return"actor"};a.clone=function(b){return new a({id:b.__contactID,prefix:b.__prefix,text:c("gkx")("4839")?l(b.__text,b.__prefix):b.__text.slice(1)},b.__key)};a.importJSON=function(a){return j({id:a.id,prefix:a.prefix,text:a.text})};var e=a.prototype;e.exportJSON=function(){return babelHelpers["extends"]({},b.prototype.exportJSON.call(this),{id:this.__contactID,prefix:this.__prefix,text:c("gkx")("4839")?l(this.__text,this.__prefix):this.__text.slice(1),type:"actor"})};function a(a,d){var e=a.id,f=a.prefix;f=f===void 0?"@":f;a=a.text;a=b.call(this,c("gkx")("4839")?k(a,f):a.startsWith(f)?a:""+f+a,d)||this;a.__contactID=h(e);a.__prefix=f;return a}e.createDOM=function(a){a=b.prototype.createDOM.call(this,a);a.className="xv78j7m xt0e3qv x3jgonx";a.spellcheck=!1;return a};e.getEntity=function(){return{id:this.__contactID,isWeak:!1}};e.getRangeType=function(){return d("MWChatComposerTypeaheadUtil").commandToRangeType(c("gkx")("4839")?l(this.__text,this.__prefix):this.__text.slice(1))};return a}(d("MessengerLexicalEntityTextNode").MessengerLexicalEntityTextNode);function j(a,b){b===void 0&&(b="segmented");return new i(a).setMode(b).toggleDirectionless()}function a(a){return a instanceof i}function k(a,b){return a.startsWith(b)?a:""+b+a}function l(a,b){return a.startsWith(b)?a.slice(b.length):a}g.MessengerLexicalActorNode=i;g.$createMessengerLexicalActorNode=j;g.$isMessengerLexicalActorNode=a}),98);
__d("messengerMentionsLexicalCreateNodeStrategy",["MessengerLexicalActorNode","cometBaseMentionsLexicalCreateNodeStrategy","cometMentionsDataEntryText"],(function(a,b,c,d,e,f,g){"use strict";a=c("cometBaseMentionsLexicalCreateNodeStrategy")(function(a){return d("MessengerLexicalActorNode").$createMessengerLexicalActorNode({id:a.key,text:c("cometMentionsDataEntryText")(a)})});b=a;g["default"]=b}),98);
__d("useCommunityMembers",["I64","Int64Hooks","LSClearCommunityMembersAndRangeStoredProcedure","LSFactory","LSIntEnum","LSIssueCommunityMemberListFetchStoredProcedure","LSVec","MWCMThreadTypes.react","ReQL","ReQLSuspense","asyncToGeneratorRuntime","promiseDone","react","react-compiler-runtime","useReStore"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j,k;(k||d("react")).useCallback;function a(a,e,g){var k=d("react-compiler-runtime").c(6),l=(h||(h=c("useReStore")))(),m,n;k[0]!==a||k[1]!==l||k[2]!==e||k[3]!==g?(m=function(){var h=function(){var h=b("asyncToGeneratorRuntime").asyncToGenerator(function*(){yield l.runInTransaction(function(b){return c("LSIssueCommunityMemberListFetchStoredProcedure")(c("LSFactory")(b),{communityId:a,fetchAdminsOnly:!1,fetchFriendMembersOnly:!1,maxName:"",maxTimestampMs:(i||(i=d("I64"))).zero,nextPageCursor:"",requestId:e,roles:c("LSVec").ofArray([(j||(j=d("LSIntEnum"))).ofNumber(0)]),source:j.ofNumber(13),threadKey:(b=g)!=null?b:void 0,threadRoles:c("LSVec").ofArray([])})},"readwrite",void 0,void 0,f.id+":44")});return function(){return h.apply(this,arguments)}}();c("promiseDone")(h())},n=[a,l,e,g],k[0]=a,k[1]=l,k[2]=e,k[3]=g,k[4]=m,k[5]=n):(m=k[4],n=k[5]);d("Int64Hooks").useEffectInt64(m,n)}function e(a,b,e){var g=d("react-compiler-runtime").c(10),i=(h||(h=c("useReStore")))(),j;g[0]!==a||g[1]!==i.tables.community_members_ranges_v2__generated||g[2]!==e||g[3]!==b?(j=function(){return d("ReQL").fromTableAscending(i.tables.community_members_ranges_v2__generated).getKeyRange(a).filter(function(a){if(a.requestId!==b)return!1;return e!=null?a.isAdmin===e:!0})},g[0]=a,g[1]=i.tables.community_members_ranges_v2__generated,g[2]=e,g[3]=b,g[4]=j):j=g[4];var k;g[5]!==a||g[6]!==i||g[7]!==e||g[8]!==b?(k=[i,a,e,b],g[5]=a,g[6]=i,g[7]=e,g[8]=b,g[9]=k):k=g[9];return d("ReQLSuspense").useFirst(j,k,f.id+":76")}function l(a){var b=d("react-compiler-runtime").c(3),e=a===void 0?7:a,g=(h||(h=c("useReStore")))();b[0]!==g||b[1]!==e?(a=function(a){return g.runInTransaction(function(b){return c("LSClearCommunityMembersAndRangeStoredProcedure")(c("LSFactory")(b),{requestId:a,source:(j||(j=d("LSIntEnum"))).ofNumber(e)})},"readwrite",void 0,void 0,f.id+":98")},b[0]=g,b[1]=e,b[2]=a):a=b[2];return a}function m(a){var e=d("react-compiler-runtime").c(12),g=a.communityIdOrThreadKey,k=a.thread,l=a.showAdmodsOnly,m=a.showHostsOnly,n=a.source,o=a.requestId,p=l===void 0?!1:l,q=m===void 0?!1:m;e[0]!==n?(a=n===void 0?(i||(i=d("I64"))).of_int32(7):n,e[0]=n,e[1]=a):a=e[1];var r=a,s=(h||(h=c("useReStore")))(),t=k.threadKey,u=k.threadType;e[2]!==g||e[3]!==s||e[4]!==o||e[5]!==p||e[6]!==q||e[7]!==r||e[8]!==t||e[9]!==u?(l=function(){var a=c("LSVec").ofArray(p?[(j||(j=d("LSIntEnum"))).ofNumber(1),(j||(j=d("LSIntEnum"))).ofNumber(2)]:q?[(j||(j=d("LSIntEnum"))).ofNumber(3)]:[(j||(j=d("LSIntEnum"))).ofNumber(0)]),e=d("MWCMThreadTypes.react").isBroadcastThread(u)?[(j||(j=d("LSIntEnum"))).ofNumber(0)]:[],h=function(){var h=b("asyncToGeneratorRuntime").asyncToGenerator(function*(){yield s.runInTransaction(function(b){return c("LSIssueCommunityMemberListFetchStoredProcedure")(c("LSFactory")(b),{communityId:g,fetchAdminsOnly:!1,fetchFriendMembersOnly:!1,maxName:"",maxTimestampMs:(i||(i=d("I64"))).zero,nextPageCursor:"",requestId:o,roles:a,source:r,threadKey:(i||(i=d("I64"))).equal(r,(i||(i=d("I64"))).of_int32(0))?void 0:t,threadRoles:c("LSVec").ofArray(e)})},"readwrite",void 0,void 0,f.id+":149")});return function(){return h.apply(this,arguments)}}();c("promiseDone")(h())},m=[s,g,t,u,p,r,o,q],e[2]=g,e[3]=s,e[4]=o,e[5]=p,e[6]=q,e[7]=r,e[8]=t,e[9]=u,e[10]=l,e[11]=m):(l=e[10],m=e[11]);d("Int64Hooks").useEffectInt64(l,m)}g.useFetchBannedMemberList=a;g.useCommunityMembersRanges=e;g.useClearMemberList=l;g.useFetchCommunityMembers=m}),98);
__d("createCometAtSignComposerMentionsMatchStrategyWithInstagramHandleSupport",["createCometMentionMatchStrategy","gkx"],(function(a,b,c,d,e,f,g){"use strict";var h=["@","\\uff20"].join(""),i=",\\+\\*\\?\\$\\@\\|#{}\\(\\)\\^\\-\\[\\]\\\\/!%'\"~=<>:;",j="(?:\\.[ |$]|[ ]['\"]|['\"][ |$]| |["+i+"]|)";function a(a){var b=a.disallowedTerms;a=a.minMatchLength;return c("createCometMentionMatchStrategy")({disallowedChars:i,disallowedTerms:b,minMatchLength:a,name:"CometAtSignComposerMentionsMatchStrategyWithInstagramHandleSupport("+a.toString()+")",triggers:h,validJoins:c("gkx")("4839")?j:void 0})}g["default"]=a}),98);
__d("useMWCMMentionsDataSourceResolverConfig",["I64","Int64Hooks","LSClearCommunityMembersAndRangeStoredProcedure","LSFactory","LSIssueCommunityMemberListFetchStoredProcedure","LSVec","Promise","asyncToGeneratorRuntime","createCometAtSignComposerMentionsMatchStrategyWithInstagramHandleSupport","pageID","promiseDone","react","react-compiler-runtime","useCometMentionsDataSourceResolverConfig","useReStore"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j,k;e=k||d("react");e.useMemo;var l=e.useRef;function a(a,e,g){var k=d("react-compiler-runtime").c(12),o=(i||(i=c("useReStore")))(),p=l(null),q;k[0]===Symbol["for"]("react.memo_cache_sentinel")?(q=[],k[0]=q):q=k[0];var r=l(q),s;k[1]!==o||k[2]!==a||k[3]!==e?(q=function(){var g=b("asyncToGeneratorRuntime").asyncToGenerator(function*(b){yield o.runInTransaction(n,"readwrite",void 0,void 0,f.id+":51"),yield o.runInTransaction(function(f){return c("LSIssueCommunityMemberListFetchStoredProcedure")(c("LSFactory")(f),{communityId:a,fetchAdminsOnly:!1,fetchFriendMembersOnly:!1,maxName:"",maxTimestampMs:(j||(j=d("I64"))).zero,nextPageCursor:"",requestId:c("pageID"),roles:c("LSVec").ofArray([j.of_int32(0)]),searchText:b,source:j.of_int32(8),threadKey:e,threadRoles:c("LSVec").ofArray([])})},"readwrite",void 0,void 0,f.id+":59")});return function(a){return g.apply(this,arguments)}}(),s=[o,a,e],k[1]=o,k[2]=a,k[3]=e,k[4]=q,k[5]=s):(q=k[4],s=k[5]);var t=d("Int64Hooks").useCallbackInt64(q,s);k[6]!==g||k[7]!==t?(q={bootstrap:function(){},fetchCache:m,fetchNetwork:function(a){return new(h||(h=b("Promise")))(function(b){(a.query!==p.current||a.query===""&&p.current!=="")&&(p.current=a.query,c("promiseDone")(t(p.current))),g.length!==0&&(r.current=g),b({entries:g.length===0?r.current:g,params:a})})}},k[6]=g,k[7]=t,k[8]=q):q=k[8];k[9]===Symbol["for"]("react.memo_cache_sentinel")?(s=c("createCometAtSignComposerMentionsMatchStrategyWithInstagramHandleSupport")({minMatchLength:0}),k[9]=s):s=k[9];k[10]!==q?(s=[{dataSource:q,matchStrategy:s}],k[10]=q,k[11]=s):s=k[11];q=s;k=q;return c("useCometMentionsDataSourceResolverConfig")(k,!1)}function m(){return{entries:[],params:{query:""}}}function n(a){return c("LSClearCommunityMembersAndRangeStoredProcedure")(c("LSFactory")(a),{requestId:c("pageID"),source:(j||(j=d("I64"))).of_int32(8)})}g["default"]=a}),98);
__d("MWCMMentionsComposerPluginCreatorWithTypeaheadViewForLexical.react",["CometMentionsForLexical.react","CometMentionsLayoutStrategy.react","I64","MWChatComposerMentionsViewItem.react","ReQL","ReQLSuspense","messengerMentionsLexicalCreateNodeStrategy","pageID","promiseDone","react","react-compiler-runtime","useCometTypeaheadViewListStrategy","useCommunityMembers","useMWCMMentionsDataSourceResolverConfig","useReStore"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j,k=j||(j=d("react")),l=j.useEffect,m={view:{minWidth:"x1jzhcrs",$$css:!0}};function a(a){var b=d("react-compiler-runtime").c(19),e=a.editor,g=a.fbGroupId,j=a.folderId;a=a.threadFBID;var o=(h||(h=c("useReStore")))(),p;b[0]!==o.tables.community_members||b[1]!==o.tables.contextual_profile_v1||b[2]!==g||b[3]!==j?(p=function(){return d("ReQL").fromTableAscending(o.tables.community_members.index("communitySource")).getKeyRange(g,(i||(i=d("I64"))).of_int32(8),c("pageID")).filter(n).take(6).map(function(a){var b,c;b=(b=d("ReQLSuspense").first(d("ReQL").fromTableAscending(o.tables.contextual_profile_v1).getKeyRange(a.contactId,j),f.id+":60"))==null?void 0:b.profileName;return{key:(i||(i=d("I64"))).to_string(a.contactId),label:(c=b)!=null?c:a.name,rawData:{photoURI:a.profilePictureUrl,source:"all",subtitle:b!=null?a.name:a.subtitle},type:"entry"}})},b[0]=o.tables.community_members,b[1]=o.tables.contextual_profile_v1,b[2]=g,b[3]=j,b[4]=p):p=b[4];var q;b[5]!==o||b[6]!==g||b[7]!==j?(q=[o,g,j],b[5]=o,b[6]=g,b[7]=j,b[8]=q):q=b[8];p=d("ReQLSuspense").useArray(p,q,f.id+":48");b[9]!==a?(q=(i||(i=d("I64"))).of_string(a),b[9]=a,b[10]=q):q=b[10];a=c("useMWCMMentionsDataSourceResolverConfig")(g,q,p);b[11]===Symbol["for"]("react.memo_cache_sentinel")?(q={viewItemStrategyRenderer:c("MWChatComposerMentionsViewItem.react"),viewXStyle:m.view},b[11]=q):q=b[11];p=c("useCometTypeaheadViewListStrategy")(q);var r=d("useCommunityMembers").useClearMemberList(8),s;b[12]!==r?(q=function(){return function(){c("promiseDone")(r(c("pageID")))}},s=[r],b[12]=r,b[13]=q,b[14]=s):(q=b[13],s=b[14]);l(q,s);b[15]!==a||b[16]!==e||b[17]!==p?(q=k.jsx(c("CometMentionsForLexical.react"),{createNodeStrategy:c("messengerMentionsLexicalCreateNodeStrategy"),dataSourceResolverConfig:a,editor:e,layoutStrategyRenderer:c("CometMentionsLayoutStrategy.react"),position:"above",viewStrategyRenderer:p}),b[15]=a,b[16]=e,b[17]=p,b[18]=q):q=b[18];return q}function n(a){a=a.isBlocked;return a!==!0}g["default"]=a}),98);
__d("MWChatAppendMentionsNodeToReply",["I64","LSContactTypeExact","LSIntEnum","Lexical","LexicalText","MWChatComposerTypeaheadUtil","MWPReplyContext.react","MessengerLexicalActorNode","ReQL","ReQLSuspense","cometMentionsDataEntryText","react","react-compiler-runtime","react-forget-runtime","usePrevious","useReStore"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j,k;b=k||d("react");b.useContext;var l=b.useEffect;function m(a,b){a.update(function(){var e=d("Lexical").$getSelection();if(!d("Lexical").$isRangeSelection(e)||!e.isCollapsed())return;var f=e.anchor;f=f.getNode();var g=c("cometMentionsDataEntryText")(b),h=d("Lexical").$getRoot().getAllTextNodes().some(function(a){return d("MessengerLexicalActorNode").$isMessengerLexicalActorNode(a)&&a.getTextContent().includes(g)});if(h===!0)return;h=d("MessengerLexicalActorNode").$createMessengerLexicalActorNode({id:b.key,text:g});var i=d("LexicalText").$isRootTextContentEmpty(a.isComposing());i?e.insertNodes([h]):f.insertBefore(h);h.selectNext(0,0)})}function a(a,b,e){var g=d("react-compiler-runtime").c(18),k=d("react-forget-runtime").useContextWithBailoutExperiment__unstable(d("MWPReplyContext.react").MWPReplyContext,n),o=k.reply,p=c("usePrevious")(o),q=(h||(h=c("useReStore")))(),r;g[0]!==q||g[1]!==o||g[2]!==b?(k=function(){return o!=null?d("ReQL").fromTableAscending(q.tables.messages).getKeyRange(b,o.timestampMs,o.messageId):d("ReQL").empty()},r=[o,b,q],g[0]=q,g[1]=o,g[2]=b,g[3]=k,g[4]=r):(k=g[3],r=g[4]);var s=d("ReQLSuspense").useFirst(k,r,f.id+":91");g[5]!==q||g[6]!==s?(k=function(){return s!=null?d("ReQL").fromTableAscending(q.tables.contacts).getKeyRange(s.senderId):d("ReQL").empty()},r=[q,s],g[5]=q,g[6]=s,g[7]=k,g[8]=r):(k=g[7],r=g[8]);k=d("ReQLSuspense").useFirst(k,r,f.id+":102");g[9]!==k?(r=k!=null?(i||(i=d("I64"))).equal(k.contactTypeExact,(j||(j=d("LSIntEnum"))).ofNumber(c("LSContactTypeExact").GENERATIVE_AI_BOT)):!1,g[9]=k,g[10]=r):r=g[10];k=r;var t=k&&(s==null?void 0:s.botResponseId)!=null;g[11]!==a||g[12]!==t||g[13]!==p||g[14]!==o||g[15]!==e?(r=function(){var b=p==null&&o!=null;b&&t&&e===!0&&m(a,d("MWChatComposerTypeaheadUtil").aiBotMentionsEntry)},k=[a,o,p,t,e],g[11]=a,g[12]=t,g[13]=p,g[14]=o,g[15]=e,g[16]=r,g[17]=k):(r=g[16],k=g[17]);l(r,k)}function n(a){return[a.reply]}g.insertMentionNodeToFront=m;g.useMWChatAppendMentionsNodeToReply=a}),98);
__d("MWChatComposerMentionsTypeaheadDataSource",["CurrentUser","MWChatComposerTypeaheadUtil","Promise"],(function(a,b,c,d,e,f,g){"use strict";var h,i=6;a=function(){function a(a,b,d,e,f){this.$1=[];this.$1=Array.from(a.values()).filter(function(a){return a.contactId!==c("CurrentUser").getID()});this.$2=b;this.$3=(a=d)!=null?a:null;this.$4=e;this.$5=f}var e=a.prototype;e.bootstrap=function(){return};e.fetchCache=function(a){return d("MWChatComposerTypeaheadUtil").fetchCacheComposerMentionsTypeahead(a,this.$1,this.$2,this.$3,this.$4,this.$5,i)};e.fetchNetwork=function(a){return(h||(h=b("Promise"))).resolve(this.fetchCache(a))};return a}();g["default"]=a}),98);
__d("MWWorkForeignEntityTypeUtils",["I64","LSContactWorkForeignEntityType","LSIntEnum"],(function(a,b,c,d,e,f,g){"use strict";var h,i;function a(a){if((h||(h=d("I64"))).equal(a,(i||(i=d("LSIntEnum"))).ofNumber(c("LSContactWorkForeignEntityType").NOT_FOREIGN))||(h||(h=d("I64"))).equal(a,(i||(i=d("LSIntEnum"))).ofNumber(c("LSContactWorkForeignEntityType").UNKNOWN)))return"NOT_FOREIGN";else if((h||(h=d("I64"))).equal(a,(i||(i=d("LSIntEnum"))).ofNumber(c("LSContactWorkForeignEntityType").NOT_FOREIGN_LIMITED)))return"LIMITED";else return"FOREIGN"}g.getWorkForeignEntityType=a}),98);
__d("useMWChatMentionsDataSourceResolverConfig",["I64","LSMessagingThreadTypeUtil","LSThreadBitOffset","MWChatComposerMentionsTypeaheadDataSource","MWLSThread","createCometAtSignComposerMentionsMatchStrategyWithInstagramHandleSupport","react","useCometMentionsDataSourceResolverConfig"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j=(h||d("react")).useMemo;function a(a){var b=a.isAiBotMentionsEnabled,e=a.participants,f=a.threadFBID,g=a.triggerParticipantsSearch;a=d("MWLSThread").useThreadExn((i||(i=d("I64"))).of_string(f));var h=d("LSMessagingThreadTypeUtil").isGroup(a.threadType)&&d("LSThreadBitOffset").has(43,a);a=j(function(){return[{dataSource:new(c("MWChatComposerMentionsTypeaheadDataSource"))(e,f,g,b,h),matchStrategy:c("createCometAtSignComposerMentionsMatchStrategyWithInstagramHandleSupport")({minMatchLength:0})}]},[h,b,e,f,g]);return c("useCometMentionsDataSourceResolverConfig")(a,!0)}g["default"]=a}),98);